from contextlib import nullcontext as does_not_raise

from starlette.status import HTTP_200_OK, HTTP_422_UNPROCESSABLE_ENTITY


TEST_LAST_TRADING_DATES_PARAMS = [
    # last_trading_dates
    # POSITIVE: default
    (
        "/last_trading_dates/",
        {},
        HTTP_200_OK,
        [
            "2024-11-01",
            "2024-10-28",
            "2024-10-25",
            "2024-10-24",
            "2024-10-23",
            "2024-10-22",
            "2024-10-21",
            "2024-10-18",
            "2024-10-17",
            "2024-10-16",
        ],
        does_not_raise(),
    ),
    # POSITIVE: count greater than 1
    (
        "/last_trading_dates/",
        {"count": 5},
        HTTP_200_OK,
        [
            "2024-11-01",
            "2024-10-28",
            "2024-10-25",
            "2024-10-24",
            "2024-10-23",
        ],
        does_not_raise(),
    ),
    # NEGATIVE: count less than 1
    (
        "/last_trading_dates/",
        {"count": 0},
        HTTP_422_UNPROCESSABLE_ENTITY,
        {},
        does_not_raise(),
    ),
    # NEGATIVE: incorrect count type (string)
    (
        "/last_trading_dates/",
        {"count": "one"},
        HTTP_422_UNPROCESSABLE_ENTITY,
        {},
        does_not_raise(),
    ),
]

TEST_DYNAMICS_PARAMS = [
    # dynamics
    # POSITIVE: default
    (
        "/dynamics/",
        {},
        HTTP_200_OK,
        [
            {
                "exchange_product_id": "A10KZLY060W",
                "exchange_product_name": "Бензин (АИ-100-К5)-Евро, ст. Злынка-Экспорт (промежуточная станция)",
                "delivery_basis_name": "ст. Злынка-Экспорт",
                "volume": 60,
                "total": 5280000,
                "count": 1,
                "date": "2024-11-01",
                "oil_id": "A10K",
                "delivery_basis_id": "ZLY",
                "delivery_type_id": "W",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 200,
                "total": 12875025,
                "count": 8,
                "date": "2024-10-28",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "DW35KII065F",
                "exchange_product_name": "ДТ (ДТ-З-К5) минус 35, ст. Кириши (ст. отправления)",
                "delivery_basis_name": "ст. Кириши",
                "volume": 1625,
                "total": 123706700,
                "count": 9,
                "date": "2024-10-25",
                "oil_id": "DW35",
                "delivery_basis_id": "KII",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A100STI060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Стенькино II (ст. отправления)",
                "delivery_basis_name": "ст. Стенькино II",
                "volume": 60,
                "total": 5502000,
                "count": 1,
                "date": "2024-10-24",
                "oil_id": "A100",
                "delivery_basis_id": "STI",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 25,
                "total": 1700000,
                "count": 1,
                "date": "2024-10-23",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "ORKNUFM060F",
                "exchange_product_name": "Ортоксилол нефтяной, Уфа-группа станций (ст. отправления)",
                "delivery_basis_name": "Уфа-группа станций",
                "volume": 60,
                "total": 7080000,
                "count": 1,
                "date": "2024-10-22",
                "oil_id": "ORKN",
                "delivery_basis_id": "UFM",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 200,
                "total": 13600475,
                "count": 7,
                "date": "2024-10-21",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 150,
                "total": 10148825,
                "count": 5,
                "date": "2024-10-18",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "A100NVY060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Новоярославская (ст. отправления)",
                "delivery_basis_name": "ст. Новоярославская",
                "volume": 120,
                "total": 10796820,
                "count": 2,
                "date": "2024-10-17",
                "oil_id": "A100",
                "delivery_basis_id": "NVY",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A592AKR060F",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, ст. Аксарайская II (ст. отправления)",
                "delivery_basis_name": "ст. Аксарайская II",
                "volume": 1440,
                "total": 87651420,
                "count": 22,
                "date": "2024-10-16",
                "oil_id": "A592",
                "delivery_basis_id": "AKR",
                "delivery_type_id": "F",
            },
        ],
        does_not_raise(),
    ),
    # POSITIVE: correct date
    (
        "/dynamics/",
        {"start_date": "2024-10-20", "end_date": "2024-10-25"},
        HTTP_200_OK,
        [
            {
                "exchange_product_id": "DW35KII065F",
                "exchange_product_name": "ДТ (ДТ-З-К5) минус 35, ст. Кириши (ст. отправления)",
                "delivery_basis_name": "ст. Кириши",
                "volume": 1625,
                "total": 123706700,
                "count": 9,
                "date": "2024-10-25",
                "oil_id": "DW35",
                "delivery_basis_id": "KII",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A100STI060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Стенькино II (ст. отправления)",
                "delivery_basis_name": "ст. Стенькино II",
                "volume": 60,
                "total": 5502000,
                "count": 1,
                "date": "2024-10-24",
                "oil_id": "A100",
                "delivery_basis_id": "STI",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 25,
                "total": 1700000,
                "count": 1,
                "date": "2024-10-23",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "ORKNUFM060F",
                "exchange_product_name": "Ортоксилол нефтяной, Уфа-группа станций (ст. отправления)",
                "delivery_basis_name": "Уфа-группа станций",
                "volume": 60,
                "total": 7080000,
                "count": 1,
                "date": "2024-10-22",
                "oil_id": "ORKN",
                "delivery_basis_id": "UFM",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 200,
                "total": 13600475,
                "count": 7,
                "date": "2024-10-21",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
        ],
        does_not_raise(),
    ),
    # NEGATIVE: incorrect date values
    (
        "/dynamics/",
        {"start_date": "2024-30-20", "end_date": "2024-10-45"},
        HTTP_422_UNPROCESSABLE_ENTITY,
        {},
        does_not_raise(),
    ),
    # NEGATIVE: incorrect end_date less than start_date
    (
        "/dynamics/",
        {"start_date": "2024-12-20", "end_date": "2024-10-01"},
        HTTP_422_UNPROCESSABLE_ENTITY,
        {},
        does_not_raise(),
    ),
    # POSITIVE: oil_id filter
    (
        "/dynamics/",
        {"oil_id": "A100"},
        HTTP_200_OK,
        [
            {
                "exchange_product_id": "A100STI060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Стенькино II (ст. отправления)",
                "delivery_basis_name": "ст. Стенькино II",
                "volume": 60,
                "total": 5502000,
                "count": 1,
                "date": "2024-10-24",
                "oil_id": "A100",
                "delivery_basis_id": "STI",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A100NVY060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Новоярославская (ст. отправления)",
                "delivery_basis_name": "ст. Новоярославская",
                "volume": 120,
                "total": 10796820,
                "count": 2,
                "date": "2024-10-17",
                "oil_id": "A100",
                "delivery_basis_id": "NVY",
                "delivery_type_id": "F",
            },
        ],
        does_not_raise(),
    ),
]

TEST_TRADING_RESULTS = [
    # POSITIVE: default
    (
        "/trading_results/",
        {},
        HTTP_200_OK,
        [
            {
                "exchange_product_id": "A100NVY060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Новоярославская (ст. отправления)",
                "delivery_basis_name": "ст. Новоярославская",
                "volume": 120,
                "total": 10796820,
                "count": 2,
                "date": "2024-10-17",
                "oil_id": "A100",
                "delivery_basis_id": "NVY",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A100STI060F",
                "exchange_product_name": "Бензин (АИ-100-К5), ст. Стенькино II (ст. отправления)",
                "delivery_basis_name": "ст. Стенькино II",
                "volume": 60,
                "total": 5502000,
                "count": 1,
                "date": "2024-10-24",
                "oil_id": "A100",
                "delivery_basis_id": "STI",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "A10KZLY060W",
                "exchange_product_name": "Бензин (АИ-100-К5)-Евро, ст. Злынка-Экспорт (промежуточная станция)",
                "delivery_basis_name": "ст. Злынка-Экспорт",
                "volume": 60,
                "total": 5280000,
                "count": 1,
                "date": "2024-11-01",
                "oil_id": "A10K",
                "delivery_basis_id": "ZLY",
                "delivery_type_id": "W",
            },
            {
                "exchange_product_id": "A592ACH005A",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, Ачинский НПЗ (самовывоз автотранспортом)",
                "delivery_basis_name": "Ачинский НПЗ",
                "volume": 200,
                "total": 12875025,
                "count": 8,
                "date": "2024-10-28",
                "oil_id": "A592",
                "delivery_basis_id": "ACH",
                "delivery_type_id": "A",
            },
            {
                "exchange_product_id": "A592AKR060F",
                "exchange_product_name": "Бензин (АИ-92-К5) по ГОСТ, ст. Аксарайская II (ст. отправления)",
                "delivery_basis_name": "ст. Аксарайская II",
                "volume": 1440,
                "total": 87651420,
                "count": 22,
                "date": "2024-10-16",
                "oil_id": "A592",
                "delivery_basis_id": "AKR",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "DW35KII065F",
                "exchange_product_name": "ДТ (ДТ-З-К5) минус 35, ст. Кириши (ст. отправления)",
                "delivery_basis_name": "ст. Кириши",
                "volume": 1625,
                "total": 123706700,
                "count": 9,
                "date": "2024-10-25",
                "oil_id": "DW35",
                "delivery_basis_id": "KII",
                "delivery_type_id": "F",
            },
            {
                "exchange_product_id": "ORKNUFM060F",
                "exchange_product_name": "Ортоксилол нефтяной, Уфа-группа станций (ст. отправления)",
                "delivery_basis_name": "Уфа-группа станций",
                "volume": 60,
                "total": 7080000,
                "count": 1,
                "date": "2024-10-22",
                "oil_id": "ORKN",
                "delivery_basis_id": "UFM",
                "delivery_type_id": "F",
            },
        ],
        does_not_raise(),
    )
]
